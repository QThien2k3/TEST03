<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Door Security Dashboard v4.1 - No Auto Lock</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        :root {
            --primary-color: #3b82f6;
            --primary-dark: #2563eb;
            --primary-light: #60a5fa;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --background: #0a0e27;
            --surface: #151c3d;
            --surface-light: #1e2951;
            --surface-hover: #2a3660;
            --text-primary: #ffffff;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border: #2a3660;
            --border-light: #334155;
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.2);
            --shadow-xl: 0 20px 50px rgba(0, 0, 0, 0.3);
            --gradient-primary: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            --gradient-success: linear-gradient(135deg, #10b981 0%, #34d399 100%);
            --gradient-danger: linear-gradient(135deg, #ef4444 0%, #f87171 100%);
            --gradient-warning: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
            --gradient-dark: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            --animation-duration: 0.3s;
            --animation-timing: cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--background);
            color: var(--text-primary);
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }

        /* Alert Container - Fixed positioning */
        #alertContainer {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            width: 400px;
            max-width: 90vw;
            pointer-events: none;
        }

        #alertContainer .alert {
            pointer-events: all;
            margin-bottom: 10px;
            transform: translateX(100%);
            animation: slideInRight 0.3s ease forwards;
            position: relative;
        }

        @keyframes slideInRight {
            to { transform: translateX(0); }
        }

        /* Background Animation */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(16, 185, 129, 0.05) 0%, transparent 50%);
            animation: backgroundShift 20s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes backgroundShift {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(-5%, -5%) scale(1.05); }
            50% { transform: translate(5%, -5%) scale(0.95); }
            75% { transform: translate(0, 5%) scale(1.02); }
        }

        .dashboard-container {
            padding: 24px;
            max-width: 1600px;
            margin: 0 auto;
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Header */
        .dashboard-header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .dashboard-header h1 {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 12px;
            letter-spacing: -0.03em;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 60px rgba(59, 130, 246, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
        }

        .dashboard-header h1 i {
            font-size: 2.5rem;
        }

        .dashboard-header p {
            font-size: 1.25rem;
            color: var(--text-secondary);
            font-weight: 400;
        }

        /* Connection Status Indicator */
        .connection-status {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            background: var(--surface);
            border: 1px solid var(--border);
        }

        .connection-status.connected {
            color: var(--success-color);
            border-color: var(--success-color);
        }

        .connection-status.disconnected {
            color: var(--danger-color);
            border-color: var(--danger-color);
        }

        .connection-status i {
            font-size: 12px;
            animation: pulse 2s infinite;
        }

        /* Grid Layout */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 28px;
            margin-bottom: 32px;
        }

        /* Cards */
        .card {
            background: var(--surface);
            border-radius: 24px;
            padding: 28px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-lg);
            transition: all var(--animation-duration) var(--animation-timing);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-primary);
            opacity: 0;
            transition: opacity var(--animation-duration) ease;
        }

        .card:hover::before {
            opacity: 1;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary-color);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 24px;
        }

        .card-icon {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            margin-right: 16px;
            position: relative;
            overflow: hidden;
        }

        .card-icon i {
            font-size: 28px;
            color: white;
        }

        .card-icon::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            transform: translate(-50%, -50%) scale(0);
            border-radius: 50%;
            transition: transform 0.6s ease;
        }

        .card:hover .card-icon::after {
            transform: translate(-50%, -50%) scale(2);
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -0.02em;
        }

        /* Door Control Section */
        .door-control .card-icon {
            background: var(--gradient-success);
        }

        .door-visualization {
            width: 280px;
            height: 180px;
            margin: 24px auto;
            position: relative;
            perspective: 1200px;
        }

        .door-frame {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border-radius: 12px;
            position: relative;
            box-shadow: 
                inset 0 4px 12px rgba(0, 0, 0, 0.5),
                0 10px 30px rgba(0, 0, 0, 0.4);
            overflow: hidden;
            border: 4px solid #2a3660;
        }

        .door-frame::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, transparent 50%, rgba(139, 92, 246, 0.3) 100%);
            opacity: 0;
            transition: opacity 0.5s ease;
            border-radius: 12px;
            z-index: -1;
        }

        .door-frame.active::before {
            opacity: 1;
            animation: doorFramePulse 2s ease-in-out infinite;
        }

        @keyframes doorFramePulse {
            0%, 100% { transform: scale(1); opacity: 0.3; }
            50% { transform: scale(1.02); opacity: 0.6; }
        }

        .door-panel {
            width: 85%;
            height: 90%;
            background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
            position: absolute;
            top: 5%;
            left: 7.5%;
            border-radius: 8px;
            transition: transform 1.5s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: left center;
            box-shadow: 
                inset 0 2px 8px rgba(255, 255, 255, 0.3),
                inset 0 -2px 8px rgba(0, 0, 0, 0.3),
                0 8px 20px rgba(0, 0, 0, 0.5);
            transform-style: preserve-3d;
            backface-visibility: hidden;
        }

        .door-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent 20%,
                    rgba(255, 255, 255, 0.1) 20%,
                    rgba(255, 255, 255, 0.1) 21%
                ),
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 30%,
                    rgba(255, 255, 255, 0.05) 30%,
                    rgba(255, 255, 255, 0.05) 31%
                );
            border-radius: 8px;
        }

        .door-panel.open {
            transform: perspective(1200px) rotateY(-85deg) translateZ(30px);
            box-shadow: 
                inset 0 2px 8px rgba(255, 255, 255, 0.3),
                30px 0 50px rgba(0, 0, 0, 0.4);
        }

        .door-handle {
            width: 14px;
            height: 40px;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            border-radius: 14px;
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            box-shadow: 
                0 4px 8px rgba(0, 0, 0, 0.5),
                inset 0 2px 4px rgba(255, 255, 255, 0.5),
                inset 0 -2px 4px rgba(0, 0, 0, 0.3);
        }

        .door-handle::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, rgba(255,255,255,0.5) 0%, rgba(0,0,0,0.3) 100%);
            border-radius: 50%;
        }

        .door-status {
            margin: 20px 0;
            font-size: 1.35rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .status-indicator {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            animation: pulse 2s infinite;
            box-shadow: 0 0 10px currentColor;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); box-shadow: 0 0 10px currentColor; }
            50% { opacity: 0.7; transform: scale(1.2); box-shadow: 0 0 20px currentColor; }
        }

        .status-closed .status-indicator { background: var(--danger-color); color: var(--danger-color); }
        .status-open .status-indicator { background: var(--success-color); color: var(--success-color); }
        .status-opening .status-indicator { background: var(--warning-color); color: var(--warning-color); animation: pulse 0.5s infinite; }
        .status-closing .status-indicator { background: var(--warning-color); color: var(--warning-color); animation: pulse 0.5s infinite; }

        /* Control Buttons */
        .control-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-top: 24px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--animation-duration) var(--animation-timing);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn i {
            font-size: 1.1rem;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 4px 14px rgba(59, 130, 246, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }

        .btn-success {
            background: var(--gradient-success);
            color: white;
            box-shadow: 0 4px 14px rgba(16, 185, 129, 0.3);
        }

        .btn-success:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }

        .btn-danger {
            background: var(--gradient-danger);
            color: white;
            box-shadow: 0 4px 14px rgba(239, 68, 68, 0.3);
        }

        .btn-danger:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }

        .btn-warning {
            background: var(--gradient-warning);
            color: white;
            box-shadow: 0 4px 14px rgba(245, 158, 11, 0.3);
        }

        .btn-warning:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
        }

        /* Access Management */
        .access-management .card-icon {
            background: var(--gradient-primary);
        }

        .access-tabs {
            display: flex;
            margin-bottom: 24px;
            background: var(--background);
            border-radius: 14px;
            padding: 4px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .tab-button {
            flex: 1;
            padding: 14px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            border-radius: 10px;
            cursor: pointer;
            transition: all var(--animation-duration) ease;
            font-weight: 600;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .tab-button i {
            font-size: 1.1rem;
        }

        .tab-button:hover {
            color: var(--text-primary);
        }

        .tab-button.active {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }

        .tab-content {
            display: none;
            animation: slideIn 0.4s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes slideIn {
            from { 
                opacity: 0; 
                transform: translateY(10px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        /* Section Styling */
        .section {
            background: var(--background);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .section-header .section-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-header i {
            font-size: 24px;
            color: var(--primary-color);
        }

        .section-header strong {
            font-size: 1.1rem;
            color: var(--text-primary);
        }

        /* Toggle Switch for Auto Detection */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 32px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--surface-light);
            border: 2px solid var(--border);
            transition: .4s;
            border-radius: 32px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: var(--text-secondary);
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(28px);
            background-color: white;
        }

        /* Input Fields */
        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.95rem;
            letter-spacing: 0.3px;
        }

        .input-field {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid var(--border);
            border-radius: 12px;
            background: var(--surface);
            color: var(--text-primary);
            font-size: 15px;
            transition: all var(--animation-duration) ease;
            font-family: 'Inter', sans-serif;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
            background: var(--surface-light);
        }

        .input-field:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Scan/Detect Sections */
        .scan-section, .detect-section {
            border: 2px dashed var(--border);
            background: rgba(30, 41, 81, 0.3);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all var(--animation-duration) ease;
            position: relative;
            overflow: hidden;
        }

        .scan-section::before, .detect-section::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(59, 130, 246, 0.1) 0%, transparent 70%);
            transform: translate(-50%, -50%) scale(0);
            opacity: 0;
            transition: all 0.5s ease;
        }

        .scan-section:hover::before, .detect-section:hover::before {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }

        .scan-section:hover, .detect-section:hover {
            border-color: var(--primary-color);
            background: rgba(30, 41, 81, 0.5);
        }

        .scan-section.scanning, .detect-section.detecting {
            animation: scanPulse 1.5s infinite;
            border-color: var(--primary-color);
        }

        @keyframes scanPulse {
            0%, 100% { 
                border-color: var(--primary-color);
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4);
            }
            50% { 
                border-color: var(--primary-light);
                box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
            }
        }

        .scan-status, .rfid-status {
            margin: 12px 0;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            background: var(--surface-light);
            transition: all var(--animation-duration) ease;
            font-weight: 500;
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Lists */
        .fingerprint-list, .rfid-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: 12px;
            background: var(--surface);
            margin-top: 20px;
        }

        .list-item {
            padding: 14px 18px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background var(--animation-duration) ease;
        }

        .list-item:hover {
            background: var(--surface-light);
        }

        .list-item:last-child {
            border-bottom: none;
        }

        .list-item-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .list-item-info i {
            color: var(--primary-color);
            font-size: 18px;
        }

        .delete-btn {
            padding: 6px 14px;
            background: var(--gradient-danger);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all var(--animation-duration) ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .delete-btn i {
            font-size: 14px;
        }

        .delete-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
        }

        /* Camera Section with Enhanced Radar */
        .camera-section .card-icon {
            background: var(--gradient-danger);
        }

        .security-radar {
            width: 100%;
            height: 240px;
            position: relative;
            background: radial-gradient(circle at center, rgba(30, 41, 81, 0.9) 0%, rgba(10, 14, 39, 1) 100%);
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.5);
        }

        .radar-container {
            width: 200px;
            height: 200px;
            position: relative;
        }

        .radar-circle {
            position: absolute;
            border: 2px solid rgba(59, 130, 246, 0.2);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.1);
        }

        .radar-circle:nth-child(1) { width: 200px; height: 200px; }
        .radar-circle:nth-child(2) { width: 150px; height: 150px; }
        .radar-circle:nth-child(3) { width: 100px; height: 100px; }
        .radar-circle:nth-child(4) { width: 50px; height: 50px; }

        .radar-sweep {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            background: conic-gradient(
                from 0deg,
                transparent 0deg,
                rgba(59, 130, 246, 0.8) 10deg,
                rgba(59, 130, 246, 0.4) 30deg,
                transparent 60deg
            );
            animation: radarSweep 4s linear infinite;
            border-radius: 50%;
        }

        @keyframes radarSweep {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .radar-center {
            position: absolute;
            width: 12px;
            height: 12px;
            background: var(--primary-color);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 30px var(--primary-color);
            animation: radarCenterPulse 2s ease-in-out infinite;
        }

        @keyframes radarCenterPulse {
            0%, 100% { box-shadow: 0 0 30px var(--primary-color); }
            50% { box-shadow: 0 0 50px var(--primary-color); }
        }

        .motion-blip {
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--danger-color);
            border-radius: 50%;
            box-shadow: 0 0 20px var(--danger-color);
            animation: blipPulse 1.5s ease-out;
        }

        @keyframes blipPulse {
            0% {
                transform: scale(1);
                opacity: 1;
                box-shadow: 0 0 20px var(--danger-color);
            }
            50% {
                transform: scale(2.5);
                opacity: 0.7;
            }
            100% {
                transform: scale(4);
                opacity: 0;
            }
        }

        .motion-indicator {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 12px 24px;
            border-radius: 24px;
            font-weight: 600;
            margin: 16px auto;
            transition: all var(--animation-duration) ease;
            width: fit-content;
        }

        .motion-indicator i {
            font-size: 20px;
        }

        .motion-indicator-container {
            display: flex;
            justify-content: center;
            width: 100%;
        }

        .motion-detected {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger-color);
            border: 2px solid var(--danger-color);
            animation: alertPulse 1s ease-out infinite;
        }

        @keyframes alertPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            50% { transform: scale(1.02); box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
        }

        .motion-clear {
            background: rgba(16, 185, 129, 0.15);
            color: var(--success-color);
            border: 2px solid var(--success-color);
        }

        .camera-feed {
            width: 100%;
            height: 240px;
            background: var(--surface);
            border-radius: 16px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px dashed var(--border);
            position: relative;
            overflow: hidden;
            transition: all var(--animation-duration) ease;
        }

        .camera-feed:hover {
            border-color: var(--primary-color);
        }

        .camera-placeholder {
            text-align: center;
            color: var(--text-secondary);
            padding: 20px;
        }

        .camera-placeholder i {
            font-size: 56px;
            margin-bottom: 16px;
            opacity: 0.6;
            color: var(--primary-color);
        }

        .camera-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 14px;
        }

        /* History Section */
        .history-section {
            grid-column: 1 / -1;
        }

        .history-section .card-icon {
            background: var(--gradient-warning);
        }

        .history-filters {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            flex-wrap: wrap;
            align-items: flex-end;
        }

        .filter-group {
            flex: 1;
            min-width: 150px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .filter-select, .filter-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 10px;
            background: var(--background);
            color: var(--text-primary);
            font-size: 14px;
            transition: all var(--animation-duration) ease;
            cursor: pointer;
        }

        .filter-select:focus, .filter-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }

        .history-table-container {
            overflow-x: auto;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: var(--background);
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
        }

        .history-table th {
            background: var(--surface-light);
            padding: 16px;
            text-align: left;
            font-weight: 700;
            color: var(--text-primary);
            font-size: 0.95rem;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--border);
        }

        .history-table td {
            padding: 14px 16px;
            border-bottom: 1px solid var(--border);
            color: var(--text-secondary);
            transition: all var(--animation-duration) ease;
        }

        .history-table tr:hover td {
            background: var(--surface-light);
            color: var(--text-primary);
        }

        .history-table tr:last-child td {
            border-bottom: none;
        }

        .method-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }

        .method-badge i {
            font-size: 14px;
        }

        .method-fingerprint {
            background: rgba(139, 92, 246, 0.15);
            color: #8b5cf6;
        }

        .method-rfid {
            background: rgba(59, 130, 246, 0.15);
            color: #3b82f6;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }

        .status-badge i {
            font-size: 14px;
        }

        .status-success {
            background: rgba(16, 185, 129, 0.15);
            color: var(--success-color);
        }

        .status-failed {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger-color);
        }

        .action-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            background: rgba(245, 158, 11, 0.15);
            color: var(--warning-color);
        }

        /* System Status */
        .system-status {
            grid-column: 1 / -1;
        }

        .system-status .card-icon {
            background: var(--gradient-dark);
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-top: 24px;
        }

        .status-item {
            text-align: center;
            padding: 20px;
            background: var(--background);
            border-radius: 16px;
            border: 1px solid var(--border);
            transition: all var(--animation-duration) ease;
            position: relative;
            overflow: hidden;
        }

        .status-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-primary);
            transform: scaleX(0);
            transition: transform var(--animation-duration) ease;
        }

        .status-item:hover::before {
            transform: scaleX(1);
        }

        .status-item:hover {
            transform: translateY(-2px);
            border-color: var(--primary-color);
        }

        .status-value {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 8px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .status-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        /* Alerts */
        .alert {
            padding: 16px 20px;
            border-radius: 14px;
            margin: 16px 0;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideInAlert 0.5s ease;
            position: relative;
            overflow: hidden;
            background: var(--surface);
            border: 1px solid;
            box-shadow: var(--shadow-md);
        }

        @keyframes slideInAlert {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .alert::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: currentColor;
        }

        .alert i {
            font-size: 20px;
        }

        .alert-warning {
            border-color: var(--warning-color);
            color: var(--warning-color);
        }

        .alert-danger {
            border-color: var(--danger-color);
            color: var(--danger-color);
        }

        .alert-success {
            border-color: var(--success-color);
            color: var(--success-color);
        }

        .alert-info {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .alert-close {
            margin-left: auto;
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
            font-size: 20px;
            line-height: 1;
            opacity: 0.7;
            transition: opacity var(--animation-duration) ease;
            padding: 4px;
            border-radius: 4px;
        }

        .alert-close:hover {
            opacity: 1;
            background: rgba(255, 255, 255, 0.1);
        }

        /* System Action Buttons */
        .system-actions {
            margin-top: 24px;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--surface);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 5px;
            transition: background var(--animation-duration) ease;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .dashboard-container {
                padding: 16px;
            }

            .dashboard-header h1 {
                font-size: 2rem;
                flex-direction: column;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .control-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .status-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .history-filters {
                flex-direction: column;
            }

            .filter-group {
                width: 100%;
            }

            #alertContainer {
                width: calc(100vw - 40px);
                right: 20px;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Alert Container -->
    <div id="alertContainer"></div>

    <!-- Connection Status Indicator -->
    <div class="connection-status disconnected" id="connectionStatus">
        <i class="fas fa-circle"></i>
        <span>Đang kết nối...</span>
    </div>

    <div class="dashboard-container">
        <div class="dashboard-header">
            <h1><i class="fas fa-door-open"></i> Smart Door Security v4.1</h1>
            <p>Hệ thống cửa thông minh - Fixed RFID Auto-detection & Removed Auto-lock</p>
        </div>

        <div class="dashboard-grid">
            <!-- Door Control Section -->
            <div class="card door-control">
                <div class="card-header">
                    <div class="card-icon"><i class="fas fa-door-open"></i></div>
                    <div class="card-title">Điều Khiển Cửa</div>
                </div>
                
                <div class="door-visualization">
                    <div class="door-frame" id="doorFrame">
                        <div class="door-panel" id="doorPanel">
                            <div class="door-handle"></div>
                        </div>
                    </div>
                </div>
                
                <div class="door-status" id="doorStatus">
                    <span class="status-indicator"></span>
                    <span id="doorStatusText">Đóng</span>
                </div>
                
                <div class="control-buttons">
                    <button class="btn btn-success" onclick="doorController.openDoor()">
                        <i class="fas fa-unlock"></i>
                        <span>Mở Cửa</span>
                    </button>
                    <button class="btn btn-danger" onclick="doorController.closeDoor()">
                        <i class="fas fa-lock"></i>
                        <span>Đóng Cửa</span>
                    </button>
                    <button class="btn btn-warning" onclick="doorController.stopDoor()">
                        <i class="fas fa-pause"></i>
                        <span>Dừng</span>
                    </button>
                </div>
            </div>

            <!-- Access Management Section -->
            <div class="card access-management">
                <div class="card-header">
                    <div class="card-icon"><i class="fas fa-user-shield"></i></div>
                    <div class="card-title">Quản Lý Truy Cập</div>
                </div>

                <div class="access-tabs">
                    <button class="tab-button active" onclick="switchTab('fingerprint', this)">
                        <i class="fas fa-fingerprint"></i>
                        <span>Vân Tay</span>
                    </button>
                    <button class="tab-button" onclick="switchTab('rfid', this)">
                        <i class="fas fa-id-card"></i>
                        <span>Thẻ RFID</span>
                    </button>
                </div>

                <!-- Fingerprint Tab -->
                <div class="tab-content active" id="fingerprintTab">
                    <!-- Test Fingerprint Section -->
                    <div class="section">
                        <div class="section-header">
                            <div class="section-title">
                                <i class="fas fa-fingerprint"></i>
                                <strong>Test quét vân tay</strong>
                            </div>
                        </div>
                        
                        <div class="scan-section" id="fingerprintScanSection">
                            <div class="scan-status" id="fingerprintScanStatus">
                                Nhấn nút bên dưới để test quét vân tay
                            </div>
                            
                            <button class="btn btn-primary" id="startScanBtn" onclick="fingerprintController.startScan()" 
                                    style="width: 100%; margin-top: 12px;">
                                <i class="fas fa-fingerprint"></i>
                                <span>Bắt Đầu Test</span>
                            </button>
                            <button class="btn btn-danger" id="stopScanBtn" onclick="fingerprintController.stopScan()" 
                                    style="display: none; width: 100%; margin-top: 12px;">
                                <i class="fas fa-stop"></i>
                                <span>Dừng Test</span>
                            </button>
                        </div>

                        <!-- Fingerprint Add Section -->
                        <div class="enrollment-section" style="display: none; margin-top: 20px;" id="fingerprintEnrollSection">
                            <div style="display: flex; align-items: center; margin-bottom: 16px;">
                                <i class="fas fa-check-circle" style="font-size: 24px; margin-right: 12px; color: var(--success-color);"></i>
                                <strong style="font-size: 1.1rem; color: var(--success-color);">Vân tay đã xác minh!</strong>
                            </div>
                            
                            <div class="input-group">
                                <label>ID Vân Tay:</label>
                                <input type="text" class="input-field" id="verifiedFingerprintId" readonly>
                            </div>
                            
                            <div class="input-group">
                                <label>Tên người dùng:</label>
                                <input type="text" class="input-field" id="fingerprintName" 
                                       placeholder="Nhập tên cho vân tay này">
                            </div>
                            
                            <button class="btn btn-success" onclick="fingerprintController.enrollVerified()" style="width: 100%;">
                                <i class="fas fa-check"></i>
                                <span>Thêm Vân Tay</span>
                            </button>
                        </div>
                    </div>

                    <!-- Manual Fingerprint Add Section -->
                    <div class="section">
                        <div class="section-header">
                            <div class="section-title">
                                <i class="fas fa-plus-circle"></i>
                                <strong>Thêm vân tay thủ công</strong>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 12px;">
                            <input type="number" class="input-field" id="manualFingerprintId" 
                                   placeholder="Nhập ID" min="1" max="127">
                            <input type="text" class="input-field" id="manualFingerprintName" 
                                   placeholder="Tên người dùng">
                        </div>
                        
                        <button class="btn btn-primary" style="margin-top: 12px; width: 100%;" 
                                onclick="fingerprintController.enrollManual()">
                            <i class="fas fa-plus"></i>
                            <span>Đăng Ký Vân Tay</span>
                        </button>
                    </div>
                    
                    <!-- Fingerprint List -->
                    <div style="margin-top: 20px;">
                        <div style="margin-bottom: 12px; font-weight: 600; color: var(--text-secondary); display: flex; justify-content: space-between; align-items: center;">
                            <span><i class="fas fa-list"></i> Danh sách vân tay đã lưu:</span>
                            <button class="btn btn-warning" style="padding: 6px 12px; font-size: 12px;" onclick="fingerprintController.clearAll()">
                                <i class="fas fa-trash"></i> Xóa tất cả
                            </button>
                        </div>
                        
                        <div class="fingerprint-list" id="fingerprintList">
                            <div style="text-align: center; color: var(--text-secondary); padding: 20px;">
                                <div class="loading"></div>
                                <p style="margin-top: 12px;">Đang tải danh sách vân tay...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- RFID Tab -->
                <div class="tab-content" id="rfidTab">
                    <!-- RFID Auto-Detect Section -->
                    <div class="section">
                        <div class="section-header">
                            <div class="section-title">
                                <i class="fas fa-wifi"></i>
                                <strong>Quét thẻ RFID</strong>
                            </div>
                            <div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="rfidAutoDetect" checked onchange="rfidController.toggleAutoDetect()">
                                    <span class="slider"></span>
                                </label>
                                <span style="margin-left: 8px; font-size: 12px; color: var(--text-secondary);">Auto</span>
                            </div>
                        </div>
                        
                        <div class="detect-section" id="rfidDetectSection">
                            <div class="rfid-status" id="rfidDetectionStatus">
                                Auto-detection đang BẬT. Đặt thẻ gần cảm biến để quét tự động.
                            </div>
                            
                            <button class="btn btn-primary" onclick="rfidController.testScan()" style="width: 100%; margin-top: 12px;">
                                <i class="fas fa-id-card"></i>
                                <span>Test Quét Thẻ</span>
                            </button>
                            
                            <button class="btn btn-warning" onclick="rfidController.clearDetection()" style="width: 100%; margin-top: 8px;">
                                <i class="fas fa-times"></i>
                                <span>Clear Detection</span>
                            </button>
                        </div>

                        <!-- RFID Add Section -->
                        <div class="rfid-management" id="rfidManagementSection" style="display: none; margin-top: 20px;">
                            <div style="display: flex; align-items: center; margin-bottom: 16px;">
                                <i class="fas fa-check-circle" style="font-size: 24px; margin-right: 12px; color: var(--success-color);"></i>
                                <strong style="font-size: 1.1rem; color: var(--success-color);">Thẻ đã quét!</strong>
                            </div>
                            
                            <div class="input-group">
                                <label>UID Thẻ RFID:</label>
                                <input type="text" class="input-field" id="rfidUid" readonly>
                            </div>
                            
                            <div class="input-group">
                                <label>Tên chủ thẻ:</label>
                                <input type="text" class="input-field" id="rfidCardName" 
                                       placeholder="Nhập tên cho thẻ này">
                            </div>
                            
                            <button class="btn btn-success" onclick="rfidController.addScanned()" style="width: 100%;">
                                <i class="fas fa-check"></i>
                                <span>Thêm Thẻ</span>
                            </button>
                        </div>
                    </div>

                    <!-- Manual RFID Add Section -->
                    <div class="section">
                        <div class="section-header">
                            <div class="section-title">
                                <i class="fas fa-plus-circle"></i>
                                <strong>Thêm thẻ RFID thủ công</strong>
                            </div>
                        </div>
                        
                        <input type="text" class="input-field" id="manualRfidUid" 
                               placeholder="Nhập UID thẻ (VD: 04:XX:XX:XX)" style="margin-bottom: 12px;">
                        <input type="text" class="input-field" id="manualRfidName" 
                               placeholder="Tên chủ thẻ">
                        
                        <button class="btn btn-primary" style="margin-top: 12px; width: 100%;" 
                                onclick="rfidController.addManual()">
                            <i class="fas fa-plus"></i>
                            <span>Thêm Thẻ</span>
                        </button>
                    </div>
                    
                    <!-- RFID List -->
                    <div style="margin-top: 20px;">
                        <div style="margin-bottom: 12px; font-weight: 600; color: var(--text-secondary); display: flex; justify-content: space-between; align-items: center;">
                            <span><i class="fas fa-list"></i> Danh sách thẻ RFID đã lưu:</span>
                            <button class="btn btn-warning" style="padding: 6px 12px; font-size: 12px;" onclick="rfidController.clearAll()">
                                <i class="fas fa-trash"></i> Xóa tất cả
                            </button>
                        </div>
                        
                        <div class="rfid-list" id="rfidList">
                            <div style="text-align: center; color: var(--text-secondary); padding: 20px;">
                                <div class="loading"></div>
                                <p style="margin-top: 12px;">Đang tải danh sách thẻ RFID...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Camera Section -->
            <div class="card camera-section">
                <div class="card-header">
                    <div class="card-icon"><i class="fas fa-video"></i></div>
                    <div class="card-title">Camera An Ninh</div>
                </div>

                <!-- Enhanced Security Radar -->
                <div class="security-radar" id="securityRadar">
                    <div class="radar-container">
                        <div class="radar-circle"></div>
                        <div class="radar-circle"></div>
                        <div class="radar-circle"></div>
                        <div class="radar-circle"></div>
                        <div class="radar-sweep"></div>
                        <div class="radar-center"></div>
                        <div id="motionBlips"></div>
                    </div>
                </div>

                <div class="motion-indicator-container">
                    <div class="motion-indicator motion-clear" id="motionIndicator">
                        <i class="fas fa-shield-alt"></i>
                        <span id="motionText">Không có chuyển động</span>
                    </div>
                </div>

                <div class="camera-feed" id="cameraFeed">
                    <div class="camera-placeholder">
                        <i class="fas fa-camera"></i>
                        <div>Camera sẽ tự động chụp khi có chuyển động</div>
                        <div style="font-size: 14px; margin-top: 10px; opacity: 0.7;">
                            Ảnh sẽ được gửi về email ngay lập tức
                        </div>
                    </div>
                </div>

                <div class="control-buttons">
                    <button class="btn btn-primary" onclick="cameraController.manualCapture()">
                        <i class="fas fa-camera"></i>
                        <span>Chụp Thủ Công</span>
                    </button>
                    <button class="btn btn-success" id="autoCaptureBtn" onclick="cameraController.toggleAuto()">
                        <i class="fas fa-sync-alt"></i>
                        <span>Tự Động: ON</span>
                    </button>
                </div>

                <div style="margin-top: 20px; padding: 16px; background: var(--background); border-radius: 12px;">
                    <div style="font-size: 14px; color: var(--text-secondary); line-height: 1.6;">
                        <div><i class="fas fa-envelope"></i> Email: phamquocthien17@gmail.com</div>
                        <div><i class="fas fa-robot"></i> Tự động gửi ảnh khi phát hiện chuyển động</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- History Section -->
        <div class="card history-section">
            <div class="card-header">
                <div class="card-icon"><i class="fas fa-history"></i></div>
                <div class="card-title">Lịch Sử Truy Cập</div>
            </div>

            <div class="history-filters">
                <div class="filter-group">
                    <label>Ngày:</label>
                    <input type="date" class="filter-input" id="filterDate" onchange="historyController.filter()">
                </div>
                <div class="filter-group">
                    <label>Tháng:</label>
                    <select class="filter-select" id="filterMonth" onchange="historyController.filter()">
                        <option value="">Tất cả</option>
                        <option value="1">Tháng 1</option>
                        <option value="2">Tháng 2</option>
                        <option value="3">Tháng 3</option>
                        <option value="4">Tháng 4</option>
                        <option value="5">Tháng 5</option>
                        <option value="6">Tháng 6</option>
                        <option value="7">Tháng 7</option>
                        <option value="8">Tháng 8</option>
                        <option value="9">Tháng 9</option>
                        <option value="10">Tháng 10</option>
                        <option value="11">Tháng 11</option>
                        <option value="12">Tháng 12</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Năm:</label>
                    <select class="filter-select" id="filterYear" onchange="historyController.filter()">
                        <option value="">Tất cả</option>
                        <option value="2025">2025</option>
                        <option value="2024">2024</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Phương thức:</label>
                    <select class="filter-select" id="filterMethod" onchange="historyController.filter()">
                        <option value="">Tất cả</option>
                        <option value="fingerprint">Vân tay</option>
                        <option value="rfid">Thẻ RFID</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>&nbsp;</label>
                    <button class="btn btn-primary" onclick="historyController.export()">
                        <i class="fas fa-file-excel"></i>
                        <span>Xuất Excel</span>
                    </button>
                    <button class="btn btn-warning" onclick="historyController.clearHistory()" style="margin-top: 8px;">
                        <i class="fas fa-trash"></i>
                        <span>Xóa lịch sử</span>
                    </button>
                </div>
            </div>

            <div class="history-table-container">
                <table class="history-table">
                    <thead>
                        <tr>
                            <th>Thời gian</th>
                            <th>Phương thức</th>
                            <th>ID/UID</th>
                            <th>Tên</th>
                            <th>Kết quả</th>
                            <th>Hành động</th>
                        </tr>
                    </thead>
                    <tbody id="historyTableBody">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px;">
                                <div class="loading"></div>
                                <p style="margin-top: 12px;">Đang tải lịch sử...</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- System Status Section -->
        <div class="card system-status">
            <div class="card-header">
                <div class="card-icon"><i class="fas fa-cogs"></i></div>
                <div class="card-title">Trạng Thái Hệ Thống</div>
            </div>

            <div class="status-grid">
                <div class="status-item">
                    <div class="status-value" id="statusUptime">--</div>
                    <div class="status-label">Thời gian hoạt động</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="statusConnected">--</div>
                    <div class="status-label">Kết nối E-Ra</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="statusFingerprints">--</div>
                    <div class="status-label">Vân tay đã lưu</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="statusRfidCards">--</div>
                    <div class="status-label">Thẻ RFID</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="statusCameraCaptures">--</div>
                    <div class="status-label">Ảnh đã chụp</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="statusTotalAccess">--</div>
                    <div class="status-label">Tổng lượt truy cập</div>
                </div>
            </div>

            <!-- System Action Buttons -->
            <div class="system-actions">
                <button class="btn btn-warning" onclick="alertManager.clear()">
                    <i class="fas fa-times-circle"></i>
                    <span>Xóa tất cả cảnh báo</span>
                </button>
                <button class="btn btn-primary" onclick="systemController.restart()">
                    <i class="fas fa-sync-alt"></i>
                    <span>Khởi động lại</span>
                </button>
                <button class="btn btn-danger" onclick="debugController.toggle()">
                    <i class="fas fa-bug"></i>
                    <span>Debug Panel</span>
                </button>
            </div>
        </div>
    </div>

    <!-- E-Ra Widget Integration -->
    <script src="https://www.unpkg.com/@eohjsc/era-widget@1.1.3/src/index.js"></script>
    <script>
        /**
         * ===================================
         * E-Ra IoT Dashboard Integration v4.1
         * Smart Door Security System - Fixed RFID Auto-detection & Removed Auto-lock
         * ===================================
         */

        // === E-Ra Widget Instance ===
        const eraWidget = new EraWidget();
        
        // === Configuration Storage ===
        let configs = {};
        let actions = {};
        
        // === System State Variables ===
        let systemState = {
            doorStatus: 'closed',
            motionDetected: false,
            autoCapture: true,
            fingerprintScanActive: false,
            rfidAutoDetect: true, // NEW: RFID auto-detection control
            currentVerifiedFingerprintId: null,
            currentScannedRfidUid: null,
            fingerprintList: [],
            rfidList: [],
            accessHistory: [],
            systemStats: {},
            isConnected: false,
            lastMotionTime: 0,
            lastRfidDetection: null // NEW: Track last RFID detection
        };

        // === Alert Manager ===
        const alertManager = {
            alerts: new Map(),
            
            show(id, message, type = 'success', timeout = 5000, persistent = false) {
                this.remove(id);
                
                const container = document.getElementById('alertContainer');
                const alert = document.createElement('div');
                alert.className = `alert alert-${type}`;
                alert.id = `alert-${id}`;
                alert.innerHTML = `
                    <span>${message}</span>
                    <button class="alert-close" onclick="alertManager.remove('${id}')">×</button>
                `;
                
                container.appendChild(alert);
                this.alerts.set(id, alert);
                
                if (!persistent && timeout > 0) {
                    setTimeout(() => this.remove(id), timeout);
                }
            },
            
            remove(id) {
                const alert = this.alerts.get(id);
                if (alert && alert.parentElement) {
                    alert.remove();
                    this.alerts.delete(id);
                }
            },
            
            clear() {
                this.alerts.forEach((alert, id) => this.remove(id));
                this.show('cleared', '🗑️ Đã xóa tất cả cảnh báo', 'success', 3000);
            }
        };

        // === System Controller ===
        const systemController = {
            restart() {
                if (confirm('Khởi động lại hệ thống?')) {
                    alertManager.clear();
                    systemState.fingerprintScanActive = false;
                    systemState.currentVerifiedFingerprintId = null;
                    systemState.currentScannedRfidUid = null;
                    systemState.lastRfidDetection = null;
                    
                    // Reset UI
                    doorStatusHandler.update('closed');
                    motionHandler.processMotion(false);
                    
                    // Reset RFID detection status
                    const statusEl = document.getElementById('rfidDetectionStatus');
                    statusEl.textContent = systemState.rfidAutoDetect ? 
                        'Auto-detection đang BẬT. Đặt thẻ gần cảm biến để quét tự động.' :
                        'Auto-detection đang TẮT. Nhấn "Test Quét Thẻ" để quét thủ công.';
                    statusEl.style.background = 'var(--surface-light)';
                    statusEl.style.color = 'var(--text-primary)';
                    
                    alertManager.show('system-restart', '🔄 Hệ thống đã được khởi động lại', 'success', 3000);
                }
            }
        };

        // === Connection Manager ===
        const connectionManager = {
            updateStatus(connected) {
                systemState.isConnected = connected;
                const statusEl = document.getElementById('connectionStatus');
                
                if (connected) {
                    statusEl.className = 'connection-status connected';
                    statusEl.innerHTML = '<i class="fas fa-circle"></i><span>Đã kết nối E-Ra</span>';
                    alertManager.show('era-connected', '✅ Đã kết nối thành công với E-Ra IoT Platform', 'success', 3000);
                } else {
                    statusEl.className = 'connection-status disconnected';
                    statusEl.innerHTML = '<i class="fas fa-circle"></i><span>Mất kết nối</span>';
                    alertManager.show('era-disconnected', '❌ Mất kết nối với E-Ra Platform', 'danger', 5000);
                }
            },
            
            testConnection() {
                if (!actions.openDoor) {
                    alertManager.show('connection-test', '❌ E-Ra chưa connected! Kiểm tra cấu hình.', 'danger', 5000);
                    return false;
                }
                alertManager.show('connection-test', '✅ E-Ra đã kết nối thành công!', 'success', 3000);
                return true;
            }
        };

        // === E-Ra Widget Initialization ===
        function initializeEraWidget() {
            eraWidget.init({
                onConfiguration: (configuration) => {
                    console.log('[E-Ra] Configuration received:', configuration);
                    
                    // Map Realtime Configs (Read-Only Data)
                    configs = {
                        doorStatus:         configuration.realtime_configs[0],  // V1
                        motion:             configuration.realtime_configs[1],  // V2
                        accessLog:          configuration.realtime_configs[2],  // V3
                        alert:              configuration.realtime_configs[3],  // V6
                        systemStatus:       configuration.realtime_configs[4],  // V8
                        cameraStatus:       configuration.realtime_configs[5],  // V9
                        cameraImage:        configuration.realtime_configs[6],  // V10
                        fingerprintScan:    configuration.realtime_configs[7],  // V11
                        rfidDetect:         configuration.realtime_configs[8],  // V12
                    };
                    
                    // Map Actions (Write-Only Commands)
                    actions = {
                        closeDoor:              configuration.actions[0],   // V0 = 0
                        openDoor:               configuration.actions[1],   // V0 = 1
                        stopDoor:               configuration.actions[2],   // V0 = 2
                        fingerprintTestScan:    configuration.actions[3],   // V4 = 1
                        fingerprintTestStop:    configuration.actions[4],   // V4 = 2
                        fingerprintEnroll:      configuration.actions[5],   // V4 = 3
                        fingerprintDelete:      configuration.actions[6],   // V4 = 4
                        rfidTestScan:           configuration.actions[7],    // V5 = 1
                        rfidAdd:                configuration.actions[8],    // V5 = 2
                        rfidRemove:             configuration.actions[9],    // V5 = 3
                        cameraMotionTrigger:    configuration.actions[10],  // V7 = 1
                        cameraManualTrigger:    configuration.actions[11],  // V7 = 2
                    };
                    
                    console.log('[E-Ra] Configuration mapping completed');
                    connectionManager.updateStatus(true);
                },

                onValues: (values) => {
                    console.log('[E-Ra] Values received:', values);
                    
                    // Update door status (V1)
                    if (configs.doorStatus && values[configs.doorStatus.id]) {
                        doorStatusHandler.update(values[configs.doorStatus.id].value);
                    }

                    // Update motion detection (V2) with debouncing
                    if (configs.motion && values[configs.motion.id]) {
                        motionHandler.update(values[configs.motion.id].value);
                    }

                    // Update access log (V3) with improved deduplication
                    if (configs.accessLog && values[configs.accessLog.id]) {
                        historyController.addEntry(values[configs.accessLog.id].value);
                    }

                    // Update system status (V8)
                    if (configs.systemStatus && values[configs.systemStatus.id]) {
                        systemStatusHandler.update(values[configs.systemStatus.id].value);
                    }

                    // Update camera status (V9)
                    if (configs.cameraStatus && values[configs.cameraStatus.id]) {
                        cameraStatusHandler.update(values[configs.cameraStatus.id].value);
                    }

                    // Update camera image (V10)
                    if (configs.cameraImage && values[configs.cameraImage.id]) {
                        cameraController.displayImage(values[configs.cameraImage.id].value);
                    }

                    // Update fingerprint scan status (V11)
                    if (configs.fingerprintScan && values[configs.fingerprintScan.id]) {
                        fingerprintStatusHandler.update(values[configs.fingerprintScan.id].value);
                    }

                    // Update RFID detection (V12) with improved filtering
                    if (configs.rfidDetect && values[configs.rfidDetect.id]) {
                        rfidStatusHandler.update(values[configs.rfidDetect.id].value);
                    }
                }
            });
        }

        // === Door Controller ===
        const doorController = {
            openDoor() {
                if (!connectionManager.testConnection()) return;
                
                console.log('[Door] Sending open command: V0 = 1');
                eraWidget.sendAction(actions.openDoor.id, 1);
                alertManager.show('door-opening', '🚪 Đang gửi lệnh mở cửa...', 'success', 2000);
                doorStatusHandler.update('opening');
            },

            closeDoor() {
                if (!connectionManager.testConnection()) return;
                
                console.log('[Door] Sending close command: V0 = 0');
                eraWidget.sendAction(actions.closeDoor.id, 0);
                alertManager.show('door-closing', '🚪 Đang gửi lệnh đóng cửa...', 'warning', 2000);
                doorStatusHandler.update('closing');
            },

            stopDoor() {
                if (!connectionManager.testConnection()) return;
                
                console.log('[Door] Sending stop command: V0 = 2');
                eraWidget.sendAction(actions.stopDoor.id, 2);
                alertManager.show('door-stopping', '⏸️ Đang dừng cửa...', 'warning', 2000);
            }
        };

        // === Door Status Handler ===
        const doorStatusHandler = {
            update(status) {
                systemState.doorStatus = status;
                console.log('[Door Status] Updated:', status);
                
                const doorPanel = document.getElementById('doorPanel');
                const doorFrame = document.getElementById('doorFrame');
                const doorStatusEl = document.getElementById('doorStatus');
                const doorStatusText = document.getElementById('doorStatusText');
                
                // Reset animations
                doorPanel.classList.remove('open');
                doorFrame.classList.remove('active');
                
                // Apply status-specific animations
                if (status === 'open') {
                    doorPanel.classList.add('open');
                } else if (status === 'opening') {
                    doorFrame.classList.add('active');
                    setTimeout(() => doorPanel.classList.add('open'), 500);
                } else if (status === 'closing') {
                    doorFrame.classList.add('active');
                    doorPanel.classList.remove('open');
                }
                
                // Update status text and indicator
                const statusMap = {
                    'closed': { text: 'Đóng', class: 'status-closed' },
                    'open': { text: 'Mở', class: 'status-open' },
                    'opening': { text: 'Đang Mở', class: 'status-opening' },
                    'closing': { text: 'Đang Đóng', class: 'status-closing' }
                };
                
                const statusInfo = statusMap[status] || { text: status, class: '' };
                doorStatusText.textContent = statusInfo.text;
                doorStatusEl.className = `door-status ${statusInfo.class}`;
            }
        };

        // === Fingerprint Controller ===  
        const fingerprintController = {
            startScan() {
                if (!connectionManager.testConnection()) return;
                
                console.log('[Fingerprint] Sending test scan command: V4 = 1');
                eraWidget.sendAction(actions.fingerprintTestScan.id, 1);
                
                systemState.fingerprintScanActive = true;
                document.getElementById('startScanBtn').style.display = 'none';
                document.getElementById('stopScanBtn').style.display = 'inline-flex';
                document.getElementById('fingerprintScanSection').classList.add('scanning');
                
                // Update status immediately
                const statusEl = document.getElementById('fingerprintScanStatus');
                statusEl.textContent = '👆 Đặt ngón tay lên cảm biến AS608...';
                statusEl.style.background = 'var(--primary-color)';
                statusEl.style.color = 'white';
                
                alertManager.show('fp-scan-start', '👆 Test quét vân tay đã bắt đầu. Đặt ngón tay lên cảm biến!', 'success', 3000);
            },

            stopScan() {
                if (!actions.fingerprintTestStop) return;
                
                console.log('[Fingerprint] Sending test stop command: V4 = 2');
                eraWidget.sendAction(actions.fingerprintTestStop.id, 2);
                
                systemState.fingerprintScanActive = false;
                document.getElementById('startScanBtn').style.display = 'inline-flex';
                document.getElementById('stopScanBtn').style.display = 'none';
                document.getElementById('fingerprintScanSection').classList.remove('scanning');
                document.getElementById('fingerprintEnrollSection').style.display = 'none';
                
                // Reset status
                const statusEl = document.getElementById('fingerprintScanStatus');
                statusEl.textContent = 'Nhấn nút bên dưới để test quét vân tay';
                statusEl.style.background = 'var(--surface-light)';
                statusEl.style.color = 'var(--text-primary)';
                
                alertManager.show('fp-scan-stop', '⏹️ Đã dừng test quét vân tay', 'warning', 2000);
            },

            enrollVerified() {
                const name = document.getElementById('fingerprintName').value.trim();
                
                if (!name) {
                    alertManager.show('fp-name-required', '⚠️ Vui lòng nhập tên người dùng', 'warning', 3000);
                    return;
                }

                if (!systemState.currentVerifiedFingerprintId) {
                    alertManager.show('fp-no-verified', '⚠️ Không có vân tay được xác minh', 'warning', 3000);
                    return;
                }

                if (!connectionManager.testConnection()) return;

                console.log('[Fingerprint] Sending enroll command: V4 = 3');
                eraWidget.sendAction(actions.fingerprintEnroll.id, 3);
                
                // Add to local list  
                const enrollData = {
                    id: systemState.currentVerifiedFingerprintId,
                    name: name
                };
                
                systemState.fingerprintList.push(enrollData);
                systemState.fingerprintList.sort((a, b) => a.id - b.id);
                
                alertManager.show('fp-enrolled', 
                    `✅ Đã thêm vân tay "${name}" với ID ${systemState.currentVerifiedFingerprintId}`, 
                    'success', 3000);
                
                // Clear form and hide
                document.getElementById('fingerprintName').value = '';
                document.getElementById('verifiedFingerprintId').value = '';
                document.getElementById('fingerprintEnrollSection').style.display = 'none';
                systemState.currentVerifiedFingerprintId = null;
                
                // Stop scan
                this.stopScan();
                this.updateList();
            },

            enrollManual() {
                const id = parseInt(document.getElementById('manualFingerprintId').value);
                const name = document.getElementById('manualFingerprintName').value.trim();
                
                if (!id || id < 1 || id > 127) {
                    alertManager.show('fp-invalid-id', '⚠️ Vui lòng nhập ID hợp lệ (1-127)', 'warning', 3000);
                    return;
                }
                
                if (!name) {
                    alertManager.show('fp-name-required', '⚠️ Vui lòng nhập tên người dùng', 'warning', 3000);
                    return;
                }
                
                // Check if ID already exists
                if (systemState.fingerprintList.some(fp => fp.id === id)) {
                    alertManager.show('fp-id-exists', '⚠️ ID này đã tồn tại!', 'warning', 3000);
                    return;
                }

                if (!connectionManager.testConnection()) return;

                console.log('[Fingerprint] Sending manual enroll command: V4 = 3');
                eraWidget.sendAction(actions.fingerprintEnroll.id, 3);
                
                // Add to local list
                systemState.fingerprintList.push({ id, name });
                systemState.fingerprintList.sort((a, b) => a.id - b.id);
                
                alertManager.show('fp-manual-enrolled', `✅ Đã thêm vân tay "${name}" với ID ${id}`, 'success', 3000);
                
                // Clear form
                document.getElementById('manualFingerprintId').value = '';
                document.getElementById('manualFingerprintName').value = '';
                
                this.updateList();
            },

            delete(id) {
                if (!confirm(`Xác nhận xóa vân tay ID #${id}?`)) return;
                
                if (!connectionManager.testConnection()) return;

                console.log('[Fingerprint] Sending delete command: V4 = 4');
                eraWidget.sendAction(actions.fingerprintDelete.id, 4);
                
                // Remove from local list
                const fingerprint = systemState.fingerprintList.find(fp => fp.id === id);
                systemState.fingerprintList = systemState.fingerprintList.filter(fp => fp.id !== id);
                
                alertManager.show('fp-deleted', `🗑️ Đã xóa vân tay "${fingerprint?.name || 'Unknown'}" (ID #${id})`, 'success', 3000);
                this.updateList();
            },

            clearAll() {
                if (!confirm('Xác nhận xóa TẤT CẢ vân tay?')) return;
                
                systemState.fingerprintList = [];
                this.updateList();
                alertManager.show('fp-cleared', '🗑️ Đã xóa tất cả vân tay', 'warning', 3000);
            },

            updateList() {
                const list = document.getElementById('fingerprintList');
                
                if (systemState.fingerprintList.length === 0) {
                    list.innerHTML = `
                        <div style="text-align: center; color: var(--text-secondary); padding: 20px;">
                            <i class="fas fa-fingerprint" style="font-size: 48px; opacity: 0.3; margin-bottom: 12px;"></i>
                            <p>Chưa có vân tay nào được lưu</p>
                        </div>
                    `;
                    return;
                }
                
                list.innerHTML = systemState.fingerprintList.map(fp => `
                    <div class="list-item">
                        <div class="list-item-info">
                            <i class="fas fa-fingerprint"></i>
                            <span>ID #${fp.id} - ${fp.name}</span>
                        </div>
                        <button class="delete-btn" onclick="fingerprintController.delete(${fp.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `).join('');
            }
        };

        // === Fingerprint Status Handler ===
        const fingerprintStatusHandler = {
            update(statusJson) {
                try {
                    const status = JSON.parse(statusJson);
                    console.log('[Fingerprint Status] Received:', status);
                    
                    const statusEl = document.getElementById('fingerprintScanStatus');
                    const enrollSection = document.getElementById('fingerprintEnrollSection');
                    
                    // Clear previous styling
                    statusEl.style.background = 'var(--surface-light)';
                    statusEl.style.color = 'var(--text-primary)';
                    
                    switch(status.status) {
                        case 'scanning':
                            statusEl.textContent = '👆 Đặt ngón tay lên cảm biến AS608...';
                            statusEl.style.background = 'var(--primary-color)';
                            statusEl.style.color = 'white';
                            break;
                            
                        case 'detected':
                            if (!status.existing) {
                                // New fingerprint detected
                                const nextId = this.getNextAvailableId();
                                systemState.currentVerifiedFingerprintId = nextId;
                                document.getElementById('verifiedFingerprintId').value = nextId;
                                
                                statusEl.textContent = '✅ Quét thành công! Vân tay mới phát hiện.';
                                statusEl.style.background = 'var(--success-color)';
                                statusEl.style.color = 'white';
                                
                                // Show enrollment form
                                enrollSection.style.display = 'block';
                                document.getElementById('fingerprintName').focus();
                                
                                document.getElementById('fingerprintScanSection').classList.remove('scanning');
                                
                                alertManager.show('fp-new-detected', 
                                    `🎉 Phát hiện vân tay mới! Sẽ lưu với ID: ${nextId}`, 
                                    'success', 5000);
                            } else {
                                statusEl.textContent = `⚠️ Vân tay đã tồn tại với ID: ${status.id}`;
                                statusEl.style.background = 'var(--warning-color)';
                                statusEl.style.color = 'white';
                                
                                alertManager.show('fp-exists', 
                                    `⚠️ Vân tay đã tồn tại với ID: ${status.id}`, 
                                    'warning', 3000);
                            }
                            break;
                            
                        case 'exists':
                            statusEl.textContent = `⚠️ Vân tay đã tồn tại với ID: ${status.id}`;
                            statusEl.style.background = 'var(--warning-color)';
                            statusEl.style.color = 'white';
                            break;
                            
                        case 'failed':
                        case 'error':
                            statusEl.textContent = '❌ Không đọc được vân tay. Thử lại!';
                            statusEl.style.background = 'var(--danger-color)';
                            statusEl.style.color = 'white';
                            break;
                            
                        case 'ready':
                            statusEl.textContent = 'Sẵn sàng quét vân tay';
                            break;
                            
                        default:
                            statusEl.textContent = status.message || 'Trạng thái không xác định';
                            break;
                    }
                    
                } catch (e) {
                    console.error('[Fingerprint Status] Parse error:', e);
                }
            },

            getNextAvailableId() {
                const usedIds = systemState.fingerprintList.map(fp => fp.id).sort((a, b) => a - b);
                for (let i = 1; i <= 127; i++) {
                    if (!usedIds.includes(i)) {
                        return i;
                    }
                }
                return 1;
            }
        };

        // === FIXED: RFID Controller ===
        const rfidController = {
            toggleAutoDetect() {
                systemState.rfidAutoDetect = document.getElementById('rfidAutoDetect').checked;
                const statusEl = document.getElementById('rfidDetectionStatus');
                
                if (systemState.rfidAutoDetect) {
                    statusEl.textContent = 'Auto-detection đang BẬT. Đặt thẻ gần cảm biến để quét tự động.';
                    statusEl.style.background = 'var(--success-color)';
                    statusEl.style.color = 'white';
                    alertManager.show('rfid-auto-on', '🤖 RFID Auto-detection: BẬT', 'success', 2000);
                } else {
                    statusEl.textContent = 'Auto-detection đang TẮT. Nhấn "Test Quét Thẻ" để quét thủ công.';
                    statusEl.style.background = 'var(--warning-color)';
                    statusEl.style.color = 'white';
                    alertManager.show('rfid-auto-off', '📴 RFID Auto-detection: TẮT', 'warning', 2000);
                    
                    // Clear any pending detection
                    this.clearDetection();
                }
            },

            testScan() {
                if (!connectionManager.testConnection()) return;

                console.log('[RFID] Sending test scan command: V5 = 1');
                eraWidget.sendAction(actions.rfidTestScan.id, 1);
                
                document.getElementById('rfidDetectSection').classList.add('detecting');
                
                // Update status immediately
                const statusEl = document.getElementById('rfidDetectionStatus');
                statusEl.textContent = '💳 Đang quét thẻ RFID... Đặt thẻ gần cảm biến';
                statusEl.style.background = 'var(--primary-color)';
                statusEl.style.color = 'white';
                
                alertManager.show('rfid-scan-start', '💳 Đang quét thẻ RFID... Đặt thẻ gần cảm biến!', 'success', 3000);
                
                // Auto stop detection animation after 10 seconds
                setTimeout(() => {
                    document.getElementById('rfidDetectSection').classList.remove('detecting');
                    if (statusEl.textContent.includes('Đang quét')) {
                        statusEl.textContent = systemState.rfidAutoDetect ? 
                            'Auto-detection đang BẬT. Đặt thẻ gần cảm biến để quét tự động.' :
                            'Auto-detection đang TẮT. Nhấn "Test Quét Thẻ" để quét thủ công.';
                        statusEl.style.background = 'var(--surface-light)';
                        statusEl.style.color = 'var(--text-primary)';
                    }
                }, 10000);
            },

            clearDetection() {
                // Clear current detection state
                systemState.currentScannedRfidUid = null;
                systemState.lastRfidDetection = null;
                
                // Hide management section
                document.getElementById('rfidManagementSection').style.display = 'none';
                
                // Reset detection section
                document.getElementById('rfidDetectSection').classList.remove('detecting');
                
                // Reset status
                const statusEl = document.getElementById('rfidDetectionStatus');
                statusEl.textContent = systemState.rfidAutoDetect ? 
                    'Auto-detection đang BẬT. Đặt thẻ gần cảm biến để quét tự động.' :
                    'Auto-detection đang TẮT. Nhấn "Test Quét Thẻ" để quét thủ công.';
                statusEl.style.background = 'var(--surface-light)';
                statusEl.style.color = 'var(--text-primary)';
                
                alertManager.show('rfid-cleared', '🧹 Đã xóa trạng thái phát hiện RFID', 'info', 2000);
            },

            addScanned() {
                const name = document.getElementById('rfidCardName').value.trim();
                
                if (!systemState.currentScannedRfidUid) {
                    alertManager.show('rfid-no-scanned', '⚠️ Không có thẻ nào được quét', 'warning', 3000);
                    return;
                }
                
                if (!name) {
                    alertManager.show('rfid-name-required', '⚠️ Vui lòng nhập tên cho thẻ', 'warning', 3000);
                    return;
                }

                if (!connectionManager.testConnection()) return;

                console.log('[RFID] Sending add command: V5 = 2');
                eraWidget.sendAction(actions.rfidAdd.id, 2);
                
                // Add to local list
                systemState.rfidList.push({
                    uid: systemState.currentScannedRfidUid,
                    name: name
                });
                
                alertManager.show('rfid-added', 
                    `✅ Đã thêm thẻ "${name}": ${systemState.currentScannedRfidUid}`, 
                    'success', 3000);
                
                // Clear form and hide
                document.getElementById('rfidCardName').value = '';
                this.clearDetection();
                this.updateList();
            },

            addManual() {
                const uid = document.getElementById('manualRfidUid').value.trim().toUpperCase();
                const name = document.getElementById('manualRfidName').value.trim();
                
                if (!uid) {
                    alertManager.show('rfid-uid-required', '⚠️ Vui lòng nhập UID thẻ RFID', 'warning', 3000);
                    return;
                }
                
                if (!name) {
                    alertManager.show('rfid-name-required', '⚠️ Vui lòng nhập tên cho thẻ', 'warning', 3000);
                    return;
                }
                
                // Check if UID already exists
                if (systemState.rfidList.some(card => card.uid === uid)) {
                    alertManager.show('rfid-uid-exists', '⚠️ UID này đã tồn tại!', 'warning', 3000);
                    return;
                }

                if (!connectionManager.testConnection()) return;

                console.log('[RFID] Sending manual add command: V5 = 2');
                eraWidget.sendAction(actions.rfidAdd.id, 2);
                
                // Add to local list
                systemState.rfidList.push({ uid, name });
                
                alertManager.show('rfid-manual-added', `✅ Đã thêm thẻ "${name}": ${uid}`, 'success', 3000);
                
                // Clear form
                document.getElementById('manualRfidUid').value = '';
                document.getElementById('manualRfidName').value = '';
                
                this.updateList();
            },

            remove(uid) {
                if (!confirm(`Xác nhận xóa thẻ RFID ${uid}?`)) return;
                
                if (!connectionManager.testConnection()) return;

                console.log('[RFID] Sending remove command: V5 = 3');
                eraWidget.sendAction(actions.rfidRemove.id, 3);
                
                // Find card name for notification
                const card = systemState.rfidList.find(c => c.uid === uid);
                
                // Remove from local list
                systemState.rfidList = systemState.rfidList.filter(card => card.uid !== uid);
                
                alertManager.show('rfid-removed', 
                    `🗑️ Đã xóa thẻ "${card?.name || 'Unknown'}": ${uid}`, 
                    'success', 3000);
                this.updateList();
            },

            clearAll() {
                if (!confirm('Xác nhận xóa TẤT CẢ thẻ RFID?')) return;
                
                systemState.rfidList = [];
                this.updateList();
                alertManager.show('rfid-cleared', '🗑️ Đã xóa tất cả thẻ RFID', 'warning', 3000);
            },

            updateList() {
                const list = document.getElementById('rfidList');
                
                if (systemState.rfidList.length === 0) {
                    list.innerHTML = `
                        <div style="text-align: center; color: var(--text-secondary); padding: 20px;">
                            <i class="fas fa-id-card" style="font-size: 48px; opacity: 0.3; margin-bottom: 12px;"></i>
                            <p>Chưa có thẻ RFID nào được lưu</p>
                        </div>
                    `;
                    return;
                }
                
                list.innerHTML = systemState.rfidList.map(card => `
                    <div class="list-item">
                        <div class="list-item-info">
                            <i class="fas fa-id-card"></i>
                            <span>${card.uid} - ${card.name}</span>
                        </div>
                        <button class="delete-btn" onclick="rfidController.remove('${card.uid}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `).join('');
            }
        };

        // === FIXED: RFID Status Handler ===
        const rfidStatusHandler = {
            update(detectionJson) {
                try {
                    const detection = JSON.parse(detectionJson);
                    console.log('[RFID Status] Received:', detection);
                    
                    // FIXED: Only process if auto-detection is enabled OR it's a manual test
                    if (!systemState.rfidAutoDetect && !detection.manual_test) {
                        console.log('[RFID Status] Ignoring auto-detection (disabled)');
                        return;
                    }
                    
                    // FIXED: Prevent spam by checking if same UID detected recently
                    if (detection.uid && systemState.lastRfidDetection) {
                        const timeDiff = Date.now() - systemState.lastRfidDetection.time;
                        if (systemState.lastRfidDetection.uid === detection.uid && timeDiff < 10000) {
                            console.log('[RFID Status] Skipping duplicate detection within 10 seconds');
                            return;
                        }
                    }
                    
                    const statusEl = document.getElementById('rfidDetectionStatus');
                    const managementSection = document.getElementById('rfidManagementSection');
                    const uidInput = document.getElementById('rfidUid');
                    
                    if (detection.uid) {
                        // Update last detection tracker
                        systemState.lastRfidDetection = {
                            uid: detection.uid,
                            time: Date.now()
                        };
                        
                        systemState.currentScannedRfidUid = detection.uid;
                        
                        // Update status
                        if (detection.authorized) {
                            statusEl.textContent = `✅ Thẻ được ủy quyền! UID: ${detection.uid}`;
                            statusEl.style.background = 'var(--success-color)';
                            statusEl.style.color = 'white';
                            
                            // Only show notification for authorized cards
                            alertManager.show('rfid-authorized', 
                                `✅ Thẻ đã được ủy quyền: ${detection.uid}`, 
                                'success', 3000);
                        } else {
                            statusEl.textContent = `💳 Thẻ mới phát hiện! UID: ${detection.uid}`;
                            statusEl.style.background = 'var(--warning-color)';
                            statusEl.style.color = 'white';
                            
                            // Show management section for new cards
                            managementSection.style.display = 'block';
                            uidInput.value = detection.uid;
                            document.getElementById('rfidCardName').focus();
                            
                            // Only show notification for first detection of new cards
                            alertManager.show('rfid-new-detected', 
                                `💳 Phát hiện thẻ mới: ${detection.uid}`, 
                                'warning', 5000);
                        }
                        
                        // Stop detecting animation
                        document.getElementById('rfidDetectSection').classList.remove('detecting');
                    } else if (detection.message) {
                        statusEl.textContent = detection.message;
                        
                        if (detection.message.includes('Không phát hiện')) {
                            statusEl.style.background = 'var(--danger-color)';
                            statusEl.style.color = 'white';
                        }
                    }
                    
                } catch (e) {
                    console.error('[RFID Status] Parse error:', e);
                }
            }
        };

        // === Camera Controller ===
        const cameraController = {
            manualCapture() {
                if (!connectionManager.testConnection()) return;

                console.log('[Camera] Sending manual capture command: V7 = 2');
                eraWidget.sendAction(actions.cameraManualTrigger.id, 2);
                
                alertManager.show('camera-manual', '📸 Đang chụp ảnh thủ công...', 'success', 3000);
            },

            toggleAuto() {
                systemState.autoCapture = !systemState.autoCapture;
                const btn = document.getElementById('autoCaptureBtn');
                
                if (systemState.autoCapture) {
                    btn.innerHTML = '<i class="fas fa-sync-alt"></i><span>Tự Động: ON</span>';
                    btn.className = 'btn btn-success';
                    alertManager.show('camera-auto-on', '🤖 Chế độ tự động chụp: BẬT', 'success', 2000);
                } else {
                    btn.innerHTML = '<i class="fas fa-sync-alt"></i><span>Tự Động: OFF</span>';
                    btn.className = 'btn btn-primary';
                    alertManager.show('camera-auto-off', '📴 Chế độ tự động chụp: TẮT', 'warning', 2000);
                }
            },

            displayImage(base64Data) {
                if (!base64Data) return;
                
                console.log('[Camera] Received image data');
                const cameraFeed = document.getElementById('cameraFeed');
                const img = document.createElement('img');
                img.className = 'camera-image';
                img.src = `data:image/jpeg;base64,${base64Data}`;
                img.onload = () => {
                    cameraFeed.innerHTML = '';
                    cameraFeed.appendChild(img);
                    
                    alertManager.show('camera-image', '📸 Đã nhận ảnh từ camera', 'success', 2000);
                    
                    // Auto-hide after 30 seconds
                    setTimeout(() => {
                        cameraFeed.innerHTML = `
                            <div class="camera-placeholder">
                                <i class="fas fa-camera"></i>
                                <div>Camera sẽ tự động chụp khi có chuyển động</div>
                                <div style="font-size: 14px; margin-top: 10px; opacity: 0.7;">
                                    Ảnh sẽ được gửi về email ngay lập tức
                                </div>
                            </div>
                        `;
                    }, 30000);
                };
                img.onerror = () => {
                    alertManager.show('camera-error', '❌ Lỗi hiển thị ảnh từ camera', 'danger', 3000);
                };
            }
        };

        // === Motion Handler with Debouncing ===
        const motionHandler = {
            lastMotionState: false,
            motionDebounceTimer: null,
            
            update(detected) {
                // Debounce motion detection to avoid spam
                if (this.motionDebounceTimer) {
                    clearTimeout(this.motionDebounceTimer);
                }
                
                this.motionDebounceTimer = setTimeout(() => {
                    this.processMotion(detected);
                }, 1000); // 1 second debounce to reduce spam
            },
            
            processMotion(detected) {
                // Only process if state actually changed
                if (detected === this.lastMotionState) return;
                
                this.lastMotionState = detected;
                systemState.motionDetected = detected;
                systemState.lastMotionTime = Date.now();
                
                console.log('[Motion] Detection status:', detected);
                
                const indicator = document.getElementById('motionIndicator');
                const text = document.getElementById('motionText');
                const motionBlips = document.getElementById('motionBlips');
                
                if (detected) {
                    indicator.className = 'motion-indicator motion-detected';
                    text.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Phát hiện chuyển động!';
                    
                    // Add motion blip on radar
                    const blip = document.createElement('div');
                    blip.className = 'motion-blip';
                    blip.style.top = Math.random() * 180 + 10 + 'px';
                    blip.style.left = Math.random() * 180 + 10 + 'px';
                    motionBlips.appendChild(blip);
                    
                    // Remove blip after animation
                    setTimeout(() => blip.remove(), 3000);
                    
                    // Show alert only if auto capture is on
                    if (systemState.autoCapture) {
                        alertManager.show('motion-detected', 
                            '🚨 Phát hiện chuyển động! Camera đang chụp ảnh...', 
                            'danger', 3000);
                        
                        // Trigger camera if auto mode is on and connected
                        if (systemState.isConnected && actions.cameraMotionTrigger) {
                            console.log('[Camera] Sending motion trigger command: V7 = 1');
                            eraWidget.sendAction(actions.cameraMotionTrigger.id, 1);
                        }
                    } else {
                        alertManager.show('motion-detected-no-auto', 
                            '👁️ Phát hiện chuyển động (Auto capture: OFF)', 
                            'warning', 2000);
                    }
                } else {
                    indicator.className = 'motion-indicator motion-clear';
                    text.innerHTML = '<i class="fas fa-shield-alt"></i> Không có chuyển động';
                }
            }
        };

        // === System Status Handler ===
        const systemStatusHandler = {
            update(statusJson) {
                try {
                    const status = JSON.parse(statusJson);
                    systemState.systemStats = status;
                    console.log('[System Status] Received:', status);
                    
                    // Update status displays
                    document.getElementById('statusUptime').textContent = 
                        this.formatUptime(status.uptime || 0);
                    document.getElementById('statusConnected').innerHTML = 
                        '<i class="fas fa-check-circle" style="color: var(--success-color);"></i>';
                    document.getElementById('statusFingerprints').textContent = 
                        status.fingerprint_count || systemState.fingerprintList.length;
                    document.getElementById('statusRfidCards').textContent = 
                        status.rfid_cards || systemState.rfidList.length;
                    document.getElementById('statusCameraCaptures').textContent = 
                        status.camera_captures || '0';
                    document.getElementById('statusTotalAccess').textContent = 
                        systemState.accessHistory.length;
                    
                } catch (e) {
                    console.error('[System Status] Parse error:', e);
                }
            },

            formatUptime(seconds) {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                return `${hours}h ${minutes}m`;
            }
        };

        // === Camera Status Handler ===
        const cameraStatusHandler = {
            update(statusJson) {
                try {
                    const status = JSON.parse(statusJson);
                    console.log('[Camera Status] Received:', status);
                    
                    // Could update camera health indicators here
                    
                } catch (e) {
                    console.error('[Camera Status] Parse error:', e);
                }
            }
        };

        // === IMPROVED: History Controller with Better Deduplication ===
        const historyController = {
            lastLogEntry: null,
            
            addEntry(logJson) {
                try {
                    const log = JSON.parse(logJson);
                    console.log('[History] New entry:', log);
                    
                    // IMPROVED: Better deduplication logic
                    const currentTime = Date.now();
                    const logTime = log.timestamp * 1000;
                    
                    // Skip if same entry within 5 seconds
                    if (this.lastLogEntry && 
                        this.lastLogEntry.method === log.method && 
                        this.lastLogEntry.id === log.id && 
                        this.lastLogEntry.success === log.success &&
                        (currentTime - this.lastLogEntry.time) < 5000) {
                        console.log('[History] Skipping duplicate entry');
                        return;
                    }
                    
                    // IMPROVED: Don't spam failed RFID attempts
                    if (!log.success && log.method === 'rfid') {
                        const recentFailedRfid = systemState.accessHistory.filter(h => 
                            !h.success && 
                            h.method === 'rfid' && 
                            h.id === log.id &&
                            (currentTime - h.timestamp.getTime()) < 30000 // 30 seconds
                        ).length;
                        
                        if (recentFailedRfid >= 3) {
                            console.log('[History] Skipping excessive failed RFID attempts');
                            return;
                        }
                    }
                    
                    // Create history item
                    const historyItem = {
                        timestamp: new Date(logTime),
                        method: log.method,
                        id: log.id,
                        name: log.name || 'Unknown',
                        success: log.success,
                        action: log.door_status === 'opening' ? 'Mở cửa' : 'Cảnh báo'
                    };
                    
                    // Add to history
                    systemState.accessHistory.unshift(historyItem);
                    
                    // Update last entry tracker
                    this.lastLogEntry = {
                        method: log.method,
                        id: log.id,
                        success: log.success,
                        time: currentTime
                    };
                    
                    // Limit to 30 entries to prevent spam
                    if (systemState.accessHistory.length > 30) {
                        systemState.accessHistory = systemState.accessHistory.slice(0, 30);
                    }
                    
                    // Update table
                    this.updateTable();
                    
                    // Show notification only for successful access
                    if (log.success) {
                        const method = log.method === 'fingerprint' ? '👆' : '💳';
                        alertManager.show('access-success', 
                            `${method} Truy cập thành công: ${log.name || log.id}`, 
                            'success', 3000);
                    }
                    
                } catch (e) {
                    console.error('[History] Parse error:', e);
                }
            },

            updateTable() {
                const tbody = document.getElementById('historyTableBody');
                
                if (systemState.accessHistory.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                                <i class="fas fa-history" style="font-size: 48px; opacity: 0.3; margin-bottom: 12px;"></i>
                                <p>Chưa có lịch sử truy cập</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                tbody.innerHTML = systemState.accessHistory.slice(0, 20).map(item => `
                    <tr>
                        <td>${this.formatDateTime(item.timestamp)}</td>
                        <td>
                            <span class="method-badge method-${item.method}">
                                <i class="fas fa-${item.method === 'fingerprint' ? 'fingerprint' : 'id-card'}"></i>
                                ${item.method === 'fingerprint' ? 'Vân tay' : 'RFID'}
                            </span>
                        </td>
                        <td>${item.id}</td>
                        <td>${item.name}</td>
                        <td>
                            <span class="status-badge status-${item.success ? 'success' : 'failed'}">
                                <i class="fas fa-${item.success ? 'check' : 'times'}"></i>
                                ${item.success ? 'Thành công' : 'Từ chối'}
                            </span>
                        </td>
                        <td>
                            <span class="action-badge">${item.action}</span>
                        </td>
                    </tr>
                `).join('');
            },

            filter() {
                const date = document.getElementById('filterDate').value;
                const month = document.getElementById('filterMonth').value;
                const year = document.getElementById('filterYear').value;
                const method = document.getElementById('filterMethod').value;
                
                let filtered = [...systemState.accessHistory];
                
                if (date) {
                    const filterDate = new Date(date);
                    filtered = filtered.filter(item => 
                        item.timestamp.toDateString() === filterDate.toDateString()
                    );
                }
                
                if (month) {
                    filtered = filtered.filter(item => 
                        item.timestamp.getMonth() + 1 === parseInt(month)
                    );
                }
                
                if (year) {
                    filtered = filtered.filter(item => 
                        item.timestamp.getFullYear() === parseInt(year)
                    );
                }
                
                if (method) {
                    filtered = filtered.filter(item => item.method === method);
                }
                
                // Update table with filtered data
                const tbody = document.getElementById('historyTableBody');
                if (filtered.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                                <i class="fas fa-search" style="font-size: 48px; opacity: 0.3; margin-bottom: 12px;"></i>
                                <p>Không có dữ liệu phù hợp với bộ lọc</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                tbody.innerHTML = filtered.slice(0, 50).map(item => `
                    <tr>
                        <td>${this.formatDateTime(item.timestamp)}</td>
                        <td>
                            <span class="method-badge method-${item.method}">
                                <i class="fas fa-${item.method === 'fingerprint' ? 'fingerprint' : 'id-card'}"></i>
                                ${item.method === 'fingerprint' ? 'Vân tay' : 'RFID'}
                            </span>
                        </td>
                        <td>${item.id}</td>
                        <td>${item.name}</td>
                        <td>
                            <span class="status-badge status-${item.success ? 'success' : 'failed'}">
                                <i class="fas fa-${item.success ? 'check' : 'times'}"></i>
                                ${item.success ? 'Thành công' : 'Từ chối'}
                            </span>
                        </td>
                        <td>
                            <span class="action-badge">${item.action}</span>
                        </td>
                    </tr>
                `).join('');
            },

            clearHistory() {
                if (confirm('Xác nhận xóa toàn bộ lịch sử truy cập?')) {
                    systemState.accessHistory = [];
                    this.lastLogEntry = null;
                    this.updateTable();
                    alertManager.show('history-cleared', '🗑️ Đã xóa toàn bộ lịch sử truy cập', 'success', 3000);
                }
            },

            export() {
                alertManager.show('export-todo', '📊 Tính năng xuất Excel đang được phát triển', 'info', 3000);
            },

            formatDateTime(date) {
                const d = new Date(date);
                const dateStr = d.toLocaleDateString('vi-VN');
                const timeStr = d.toLocaleTimeString('vi-VN');
                return `${dateStr} ${timeStr}`;
            }
        };

        // === Debug Controller ===
        const debugController = {
            isVisible: false,
            
            toggle() {
                this.isVisible = !this.isVisible;
                if (this.isVisible) {
                    this.showPanel();
                } else {
                    this.hidePanel();
                }
            },
            
            showPanel() {
                alertManager.show('debug-panel', `
                    <div style="text-align: left;">
                        <strong>🐛 Debug Panel</strong><br>
                        <button onclick="debugTest.connection()" style="margin: 2px; padding: 4px 8px; background: var(--primary-color); color: white; border: none; border-radius: 4px; font-size: 12px;">Test Connection</button>
                        <button onclick="debugTest.door()" style="margin: 2px; padding: 4px 8px; background: var(--success-color); color: white; border: none; border-radius: 4px; font-size: 12px;">Test Door</button>
                        <button onclick="debugTest.motion()" style="margin: 2px; padding: 4px 8px; background: var(--warning-color); color: white; border: none; border-radius: 4px; font-size: 12px;">Test Motion</button><br>
                        <button onclick="debugTest.fingerprint()" style="margin: 2px; padding: 4px 8px; background: var(--danger-color); color: white; border: none; border-radius: 4px; font-size: 12px;">Test Fingerprint</button>
                        <button onclick="debugTest.rfid()" style="margin: 2px; padding: 4px 8px; background: var(--primary-color); color: white; border: none; border-radius: 4px; font-size: 12px;">Test RFID</button>
                        <button onclick="debugTest.clearData()" style="margin: 2px; padding: 4px 8px; background: var(--danger-color); color: white; border: none; border-radius: 4px; font-size: 12px;">Clear Data</button>
                    </div>
                `, 'info', 0, true);
            },
            
            hidePanel() {
                alertManager.remove('debug-panel');
            }
        };

        // === Debug Test Functions ===
        const debugTest = {
            connection() {
                connectionManager.testConnection();
            },
            
            door() {
                const statuses = ['closed', 'opening', 'open', 'closing'];
                const randomStatus = statuses[Math.floor(Math.random() * statuses.length)];
                doorStatusHandler.update(randomStatus);
                alertManager.show('debug-door', `🚪 Test door status: ${randomStatus}`, 'info', 2000);
            },

            motion() {
                const detected = Math.random() > 0.5;
                motionHandler.processMotion(detected);
                alertManager.show('debug-motion', `👁️ Test motion: ${detected ? 'detected' : 'cleared'}`, 'info', 2000);
            },

            fingerprint() {
                const scenarios = [
                    { status: 'scanning', message: 'Đang quét vân tay...' },
                    { status: 'detected', message: 'Vân tay mới được phát hiện', existing: false },
                    { status: 'exists', message: 'Vân tay đã tồn tại với ID: 1', id: 1, existing: true },
                    { status: 'failed', message: 'Không đọc được vân tay' }
                ];
                const scenario = scenarios[Math.floor(Math.random() * scenarios.length)];
                fingerprintStatusHandler.update(JSON.stringify(scenario));
                alertManager.show('debug-fingerprint', `👆 Test fingerprint: ${scenario.status}`, 'info', 2000);
            },

            rfid() {
                const scenarios = [
                    { uid: '04:' + Math.random().toString(16).substr(2, 8).toUpperCase(), authorized: true, manual_test: true },
                    { uid: 'NEW:' + Math.random().toString(16).substr(2, 6).toUpperCase(), authorized: false, manual_test: true },
                    { message: 'Không phát hiện thẻ nào', manual_test: true }
                ];
                const scenario = scenarios[Math.floor(Math.random() * scenarios.length)];
                rfidStatusHandler.update(JSON.stringify(scenario));
                alertManager.show('debug-rfid', `💳 Test RFID: ${scenario.uid || 'no card'}`, 'info', 2000);
            },

            clearData() {
                if (confirm('Xóa tất cả dữ liệu test?')) {
                    systemState.fingerprintList = [];
                    systemState.rfidList = [];
                    systemState.accessHistory = [];
                    systemState.currentVerifiedFingerprintId = null;
                    systemState.currentScannedRfidUid = null;
                    systemState.lastRfidDetection = null;
                    
                    fingerprintController.updateList();
                    rfidController.updateList();
                    historyController.updateTable();
                    
                    // Reset RFID detection
                    rfidController.clearDetection();
                    
                    alertManager.clear();
                    alertManager.show('debug-cleared', '🗑️ Đã xóa tất cả dữ liệu test', 'success', 3000);
                }
            }
        };

        // === Utility Functions ===
        function switchTab(tab, button) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tab + 'Tab').classList.add('active');
        }

        // === Initial Data Loading ===
        function loadInitialData() {
            // Load sample fingerprint list
            setTimeout(() => {
                systemState.fingerprintList = [
                    { id: 1, name: 'Admin' },
                    { id: 2, name: 'Thiện' }
                ];
                fingerprintController.updateList();
            }, 1000);

            // Load sample RFID list  
            setTimeout(() => {
                systemState.rfidList = [
                    { uid: '04:XX:XX:XX', name: 'Thẻ của Thiện' }
                ];
                rfidController.updateList();
            }, 1000);

            // Initialize empty history
            historyController.updateTable();
        }

        // === Dashboard Initialization ===
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== Smart Door Dashboard v4.1 - RFID Auto-detection Fixed ===');
            console.log('Initializing dashboard...');
            
            // Initialize E-Ra Widget
            initializeEraWidget();
            
            // Load initial data
            loadInitialData();
            
            // Set current date for filter
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('filterDate').value = today;
            
            // Initial connection status
            connectionManager.updateStatus(false);
            
            // Show initial message
            setTimeout(() => {
                if (!systemState.isConnected) {
                    alertManager.show('initial-connecting', 
                        '🔗 Đang kết nối với hệ thống E-Ra IoT...', 
                        'info', 5000);
                } else {
                    alertManager.show('initial-ready', 
                        '✅ Dashboard v4.1 đã sẵn sàng - RFID Auto-detection fixed!', 
                        'success', 3000);
                }
            }, 2000);
            
            console.log('Dashboard initialization completed');
        });

        // === Global Debug Access ===
        window.debugTest = debugTest;
        window.alertManager = alertManager;
        window.systemState = systemState;
        window.rfidController = rfidController;
        
        console.log('=== Debug functions available ===');
        console.log('- debugTest.connection()');
        console.log('- debugTest.door()');
        console.log('- debugTest.motion()');
        console.log('- debugTest.fingerprint()');
        console.log('- debugTest.rfid()');
        console.log('- debugTest.clearData()');
        console.log('- rfidController.clearDetection()');
        console.log('===============================');
    </script>
</body>
</html>
